# 인덱스

인덱스는 고정 길이를 이용하여 빠르게 접근, 해당 행에서 값의 주소를 읽어오는 방법으로 검색 시간을 단축시키는 방법입니다.

데이터를 고정 길이로 사용하는 방법은 검색 시 빠른 접근은 가능하지만, 바이트 크기 검사, 데이터의 추가, 검사, 남는 공간 등의 문제점이 발생합니다.

인덱스는 빠르게 접근하기 위해 찾는 행 접근, 주소 획득, 주소로 이동 절차를 거쳐 데이터에 접근합니다.

## 인덱스 구조

인덱스 파일은 키값, 바이트 위치가 구성요소입니다. 고정 길이 방식으로 포맷을 취할 수 있어 빠르게 값을 얻을 수 있습니다.

- 인덱스 파일은 키값, 바이트 위치가 구성요소입니다. 고정 길이 방식으로 포맷을 취할 수 있어 빠르게 값을 얻을 수 있습니다.
- 키값, 바이트 위치의 구조라서 값 부분(고정 길이)이 무한하게 증가하는 일은 없습니다.

인덱스 파일은 고정 길이, 사용자 정보는 가변 길이로 관리합니다.

### 사용자 정보 접근 순서

1. 인덱스에 찾을 정보의 키의 값에 접근, 메모리 주소 획득
2. 획득한 메모리 주소로 이동, 값 조회

#### 단점

액세스가 2 단계가 되는 단점이 있고, 업데이트 비용이 증가합니다.

#### 장점

데이터양에 의존하지 않고 빠른 검색이 가능합니다.

## 해시 인덱스

키값을 해시 함수에 대입하여 해시 값과 값의 쌍을 갖는 구조를 말합니다.

해시 값은 문자열 길에에 상관없이 동일한 크기(고정 길이)입니다.
해시 계산 비용을 데이터양에 영향을 받지 않습니다. 양이 늘어도 계산량은 같습니다. O(1), 가장 빠른 알고리즘입니다.

만약 해시가 충돌한다. => 충돌 감지 필요 => 충돌 판정 및 계산의 과정을 거칩니다.

### 해시 인덱스의 문제

해시 인덱스는 만능이 아닙니다. 해시 인덱스는 지정한 키값과 같은 것만 찾을 수 있기 때문에 범위 검색, 정렬에서 부적합니다.

해시 인덱스는 많은 검색 작업에서 단지 일부 용도에서만 빠르게 처리할 수 있습니다.

## B+Tree 인덱스

트리구조인 인덱스입니다.

루트 브랜치 리프 블록으로 이루어져 있고 검색 시 루트, 브랜치, 리프의 순서로 검색합니다.

## 다분기 트리, 이진 트리

- 브랜치의 분기가 두 개인 것 -> 이진 탐색(이진 트리)
- 브랜치의 분기가 여러 개인 것 -> B+Tree(다분기 트리)

B+Tree(다분기 트리)를 사용하는 이유는 계층을 줄여 액세스를 줄이기 위함입니다.

이진 트리는 N 계층당 2^N, B+Tree는 N 계층 당 M^N 번의 액세스가 일어납니다.

### B+Tree B-Tree

B-Tree는 브랜치 내부에서 값을 가질 수 있습니다.

B-Tree에서는 브랜치로 올라가거나 다른 리프로 이동합니다.

B+Tree는 리프에서만 값을 가집니다.

B+Tree의 브랜치는 보다 컴팩트 해집니다. 또한 광범위한 검색에서는 리프 블록 간 액세스가 가능하고 리프 블록에서 인접한 다른 리프 블록으로 건너가는 것만으로 값의 탐색이 가능하므로 효율적입니다.

## 최적화 기법

> 고유성: 중복되지 않음, 유일함

인덱스는 고유성을 보장하는 목적으로 사용될 수 있습니다.

- 해시 인덱스 : 동일한 ID -> 동일한 해시 값
- B+Tree : 동일 리프 블록 도착, 중복 체크 가능

고유성이 보장된 인덱스를 고유 인덱스, 보장되지 않은 인덱스를 비 굥유 인덱스라 합니다.

데이터 베이스 서버에서 고유성을 보장하려는 열에 인덱스를 지정하는 것이 필수 조건이지만 내부적으로 인덱스를 작성하는 것이 대부분입니다.

### 인덱스 병합

인덱스의 병합은 검색 조건이 여러 개 일 때, 검색하는 방법입니다.

1. 각 인덱스에서 각각 검색을 실시
2. 대상의 행 번호 추출
3. 집합 연산 수행
4. 남은 번호에 대해 실제 데이터 조회

### 인덱스 문제점, 해결 방안

인덱스는 본체 데이터와 별도로 유지할 필요가 있기 때문에 검색 성능은 올라가고, 업데이트 성능은 떨어집니다.

이런 문제점을 해결하기 위해서 디스크에 모아서 기록, 병렬 갱신 성능 높이기

#### 디스크에 모아서 기록

업데이트된 내용을 메모리, 전용 파일에 일시적으로 기록 후 한 번에 모아 리프 블록을 갱신합니다.

#### 병렬 성능 높이기

리프 분할 : 리프 분할은 B+Tree 인덱스에 추가/갱신/삭제 시 인덱스의 리프 블록의 내용을 이동하는 것을 말합니다.

여러 곳에서 동시에 리프 분할이 일어날 경우 인덱스의 재편성 처리가 완료될 때 가지 참조 갱신 처리를 차단하는 동작을 시행합니다.

#### 파티션 테이블

파티션 테이블은 사용자에게는 테이블이 하나로 보이지만 내부적으로 복수로 분할 관리하는 것입니다.
