# 전송 계층

전송 계층은 목적지에 신뢰할 수 있는 데이터를 전달합니다.

프로토콜로 TCP, UDP를 사용합니다.

## 전송 계층의 역할

- 오류 정정
- 전송된 데이터의 목적지가 어떤 애플리케이션인지 식별

## 연결형 통신/비 연결형 통신

연결형 통신은 신뢰할 수 있고 정확한 데이터를 전달하는 통신을, 비 연결형 통신은 효율적으로 데이터를 전달하는 통신을 말합니다.

## TCP

전송 계층에서 TCP로 전송 시 TCP 헤더가 붙고 이를 **세그먼트**라고 합니다.

데이터를 전송하려면 연결이라는 가상의 특정 통신로를 확보해야 합니다. TCP 헤더에 코드 비트가 있는 이유입니다. 전부 초깃값은 0이고 연결을 확립하려면 SYN, ACK가 필요합니다. SYN은 연결, ACK는 확인 요청입니다.

### 연결 과정 (3way hand shake)

|     구분     |  URG  |  ACK  |  PSH  |  RST  |  SYN  |  FIN  |
| :----------: | :---: | :---: | :---: | :---: | :---: | :---: |
| ----SYN----> |   0   |   0   |   0   |   0   |   1   |   0   |
| <-SYN + ACK- |   0   |   1   |   0   |   0   |   1   |   0   |
| ----ACK----> |   0   |   1   |   0   |   0   |   0   |   0   |

### 종료 과정 (4way hand shake)

|     구분     |  URG  |  ACK  |  PSH  |  RST  |  SYN  |  FIN  |
| :----------: | :---: | :---: | :---: | :---: | :---: | :---: |
| ----FIN----> |   0   |   0   |   0   |   0   |   0   |   1   |
| <----ACK---- |   0   |   1   |   0   |   0   |   0   |   0   |
| <----FIN---- |   0   |   0   |   0   |   0   |   0   |   1   |
| ----ACK----> |   0   |   1   |   0   |   0   |   0   |   0   |

### 일련번호와 확인 응답 번호

TCP의 일련번호는 송신 측에서 수신 측에게 해당 데이터가 몇 번째 데이터인지 알려주는 역할이며 이를 이용하여 수신 측은 해당 데이터가 몇 번째 데이터인지 알 수 있습니다.

### 확인 응답 번호

몇 번째 데이터를 수신했는지 송신 측에 알리는 역할을 수행합니다.

## 재전송 제어

일련번호와 확인 응답 번호를 사용하여 데이터가 손상되거나 유실된 경우에 데이터를 재 전송하게 합니다.

## 윈도우 크기

윈도우 크기는 세그먼트를 여러 개를 받는 버퍼를 의미합니다. 이 과정에서 버퍼의 범위를 넘어가면 오버플로가 발생합니다. 이러한 점 때문에 윈도우 크기를 TCP 헤더의 정보에 들어갑니다.

## 애플리케이션으로 연결

프트 번호를 이용하여 전달하기 때문에 TCP 헤더에 포트 번호에 대한 정보가 있습니다. (출발지, 도착지 포트 번호)

> 0~1023 잘 알려진 포트, 1024~ 랜덤 포트

## UDP

UDP는 비 연결형 구조로 효율성을 중시하는 프로토콜입니다.

UDP는 목적지에 상관없이 랜에서 일괄적으로 보낼 수 있습니다.

### UDP 데이터그램

UDP 데이터그램은 UDP 헤더 + 데이터을 합친 데이터 단위입니다.

### UDP 헤더의 구조

| 출발지 포트 번호 | 목적지 포트 번호 |
| ---------------- | ---------------- |
| 길이             | 체크섬           |
