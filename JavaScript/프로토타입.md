# 프로토타입

프로토타입은 자바스크립트에서 상속을 구현할 때 사용됩니다.

> 같은 함수를 상속받는 두 객체는 프로토타입에서 같은 함수를 상속받아 사용할 수 있다.

## 프로토타입 객체

프로토타입 객체는 객체의 부모 역할을 수행하는 객체입니다.

객체는 프로토타입의 메서드를 상속받아 사용할 수 있습니다. 모든 객체는 `[[Prototype]]` 내부 슬롯이 있고 프로토타입의 참조입니다. `[[Prototype]]`에 저장되는 프로토타입은 객체 생성 방식에 따라 결정됩니다.

모든 객체는 하나의 프로토타입을 가지고, 생성자 함수와 연결되어 있습니다.

## \_\_proto\_\_ 접근자 프로퍼티

`__proto__` 접근자 프로퍼티는 객체가 자신의 프로토타입에 접근하기 위해 사용되고 프로토타입을 간접적으로 접근 가능합니다.

`__proto__`는 `Object.prototype.__proto__` 의 프로퍼티이며 상속을 통해 사용합니다.

`Object.prototype`은 프로타타입 체인의 종점입니다.

### \_\_proto\_\_ 접근자 프로퍼티를 사용하는 이유

`__proto__`를 이용하여 간접적으로 접근하는 이유는 프로토타입 간 순환 참조를 막을 수 있기 때문입니다.(확인 없는 프로토타입 교체를 막을 수 있기 때문입니다.)

### 코드에서 \_\_proto__ 접근자 사용 지양

`__proto__`보단 `Object.getPrototypeOf`, `Object.setPrototypeOf`의 사용을 권장합니다. (`__proto__`는 사용할 수 없는 경우가 있습니다. Ex: 프로토타입의 교체)

## 함수 객체의 prototype 프로퍼티

함수 객체에서의 `prototype` 프로퍼티는 함수가 생성할 인스턴스의 프로토타입 객체를 가리킵니다.

생성할 인스턴스이므로 non-constructor 함수는 `prototype` 프로퍼티가 업고 프로토타입도 생성하지 않습니다.

모든 객체가 가지고 있는 `__proto__` 접근자 프로퍼티와 함수 객체만 가지고 있는 `prototype` 프로퍼티는 같은 프로포타입을 가리킵니다.

> 생성자 함수에 의해 생성된 인스턴스.\_\_proto__ === 생성자 함수.prototype

### 프로토타입과 객체간 구조

![Alt text](images/프로토타입/prototype.drawio.svg)

## 리터럴 표기법에 의한 생성자 함수, 프로토타입

리터럴 표기법에 의해 생성된 객체는 프로토타입의 constructor 프로퍼티가 가리키는 생성자 함수가 반드시 객체를 생성한 생성자 함수라 단정할 수 없습니다.

> `new 생성자 함수()` 또는 `"test"`와 같이 생성이 가능하기 때문입니다.

객체 리터럴은 `Object`를 생성자 함수로 가지는데 추상연산 `OrdinaryObjectCreate`를 호출하여 `Object.prototype`을 가지는 객체를 생성합니다.

> 객체 리터럴은 Object를 생성자 함수로 "a"는 String을 생성자 함수로 가집니다.

### 객체 생성 과정

1. 객체 리터럴이 평가될 때 추상연산 `OrdinaryObjectCreate`를 호출
2. 빈 객체 생성
3. 프로퍼티를 추가

- 객체 리터럴도 상속을 위해 프로토타입이 필요하다.
- 프로토타입과 생성자 함수는 언제나 쌍을 이룬다.

## 프로토타입 생성 시점

프로토타입은 생성자 함수가 생성되는 시점에 같이 생성됩니다. 생성자 함수는 사용자 정의 함수, 빌트인 생성자 함수로 구분할 수 있습니다.

### 사용자 정의 생성자 함수

constructor는 함수 정의가 평가되어 함수 객체를 생성하는 시점에 프로토타입도 같이 생성됩니다.

생성된 프로토타입은 `constructor` 프로퍼티만을 가지는 객체이고 사용자 정의 함수의 프로토타입의 프로토타입은 `Object.prototype`이다.

### 빌트인 생성자 함수

빌트인 생성자 함수의 프로토타입은 빌트인 생성자 함수가 생성될 때 생성되고, 빌트인 생성자 함수는 전역 객체가 생성될 때 생성됩니다.

1. 전역 객체 생성
2. 빌트인 생성자 함수 생성
3. 빌트인 생성자 함수의 프로토타입 생성

이후 생성자 함수, 리터럴표기로 객체를 생성하면 프로토타입을 생성하는 객체의 [[Prototype]]내부 슬롯에 할당됩니다.

## 객체 생성방식과 프로토타입 결정

객체의 생성과 프로토타입 결정은 `OrdinaryObjectCreate`에 의해 결정됩니다.

객체 리터럴, Object생성자 함수, 생성자함수, Object.create 클래스는 추상연산 `OrdinaryObjectCreate`에 의해 생생됩니다.

### OrdinaryObjectCreate

`OrdinaryObjectCreate`는 인수로 생성할 객체의 프로토타입, 객체에 추가할 프로퍼티 목록을 옵션으로 전달할 수 있다.

`OrdinaryObjectCreate`는 빈 객체를 생성 후 객체에 추가할 프로퍼티 목록을 빈 객체에 추가하고, 인수를 전달받은 프로토타입을 자신이 생성한 객체의 [[Prototype]] 내부 슬롯에 할당 후 반환합니다.

#### 객체 리터럴

`OrdinaryObjectCreate`에 `Object.prototype`프로토타입이 연결

#### Object 생성자 함수

1. 빈 객체 생성
2. `OrdinaryObjectCreate`호출
3. `Object.prototype` 전달
4. 프로토타입과 객체 연결

객체 리터럴은 객체 리터럴 내부에 프로퍼티를 추가하지만 Object 생성자 함수 방식은 빈 객체를 생성하고 프로퍼티를 추가해야 합니다.

#### 생성자 함수

1. `OrdinaryObjectCreate`호출
2. 생성자 함수의 prototype에 바인딩 되어있는 객체 전달

- 사용자 정의 생성자 함수와 같이 생성된 프로토타입의 프로퍼티는 constructor뿐이다.

## 프로토타입 체인

프로토타입 체인은 프로토타입 객첵 단방향 링크드 리스트 형식으로 연결되어 있는 것입니다.

자바스크립트는 객체의 프로터티에 접근시 객체에 접근하려는 프로퍼티가 없으면 자신의 부모 역할을 수행하는 프로토타입 객체의 프로퍼티를 순차적으로 검색합니다.

보통 프로토타입의 프로타타입은 `Object.prototype`이고 `Object.prototype`은 프로토타입 체인의 종점 입니다. 만약 `Object.prototype`에서도 프로퍼티를 찾지 못한다면 `undefined`를 반환합니다.

> 객체 리터럴의 프로토타입은 Object.prototype 입니다.

### 프로토타입 체인, 스코프 체인

프로토타입 체인은 상속과 프로퍼티 검색을 위한 메커니즘입니다. 스코프 체인은 식별자 검색을 위한 메커니즘입니다.

스코프 체인과 프로토타입 체인은 협력하여 식별자와 프로퍼티를 검색하는데 사용됩니다.

## 오버라이딩, 프로퍼티 섀도잉

오버라이딩은 인스턴스의 프로퍼티가 프로토타입 프로퍼티를 덮어써서 참조 시 인스턴스의 프로퍼티가 참조되는 것을 말합니다.

프로퍼티 섀도잉은 상속관계에서 프로토타입의 프로퍼티가 오버라이딩 된 상황을 말한다.

> 하위 객체를 통해 프로토타입의 프로퍼티를 변경, 삭제는 불가능하다.

## 프로토타입 교체

프로토타입을 임의의 객체로 교체 할 수 있습니다. 하지만 생성자 함수와 프로토타입간 상호 연결이 깨지기 때문에 교체하지 않는 것이 좋습니다. 연결이 깨지는 문제를 해결 할 수는 있으나 일일이 다 설정해줘야 합니다.

생성자 함수에서 프로토타입 교체는 미래에 생성할 인스턴스의 프로토타입을, 인스턴스에 의한 프로토타입 교체는 이미 생성된 객체의 프로로타입을 교체한다.

### 생성자 함수에 의한 프로토타입 교체

생성자 함수에서 프로토타입을 교체하려면 생성자 함수 내부에서 프로토타입을 지정합니다.

프로토타입으로 교체한 객체 리터럴에는 constructor 프로퍼티가 없거나, 엉뚱한 함수를 가리킬 수 있기 때문에 생성자 함수, 프로토타입간 연결을 유지, 변경하려면 constructor 프로퍼티를 추가, 변경해야 합니다.

### 인스턴스에 의한 프로토타입 교체

인스턴스에서 프로토타입을 교체하려면 __proto__접근자 프로퍼티를 이용하여 프로토타입을 교체할 수 있습니다. 인스턴스에 의한 프로토타입 교체도 생성자 함수와 프로토타입 간 연결이 깨지게 됩니다.

#### 프로토타입과 생성자 함수의 연결을 위해 수정해야 하는 부분

- 프로토타입의 constructor 프로퍼티
  
> 생성자 함수에 의한 프로토타입 교체와 같습니다.

- 생성자 함수의 prototype 프로퍼티

> 생성자 함수에서의 프로토타입 연결이 깨집니다. 생성자 함수의 prototype 프로퍼티를 수정해야 합니다.

## instanceof

instanceof는 `객체 instanceof 생성자 함수`의 형태로 사용되며 객체의 프로토타입과 생성자 함수의 prototype에 바인딩된 객체가 프로토타입 체인 상에 존재하면 `true`, 없으면 `false`로 평가한다.

즉 프로토타입을 변경해도 생성자 함수와 프로토타입 객체간 연결만 잘 되어 있으면 `true`가 반환된다.

## 정적 메서드, 정적 프로퍼티

정적 메서드, 정적 프로퍼티는 생성자 함수의 프로퍼티입니다.

생성자 함수에 의해 생성된 인스턴스는 생성자 함수의 정적 메서드, 정적 프로퍼티를 이용할 수 없습니다.

> Ex: `Object.create`

## 프로퍼티가 존재하는지 확인하는 방법

### in

프로토타입의 프로퍼티를 포함하여 확인합니다.

### Object.prototype.hasOwnProperty

객체 고유의 키만 확인합니다.

## 프로퍼티 열거

### for.. in

상속받은 프로퍼티도 같이 나열합니다.

### Object.keys/values/entries

객체 자신의 열거 가능한 프로피티를 나열합니다.

순서대로 키의 식별자, 값, 키와 값을 나열합니다.
