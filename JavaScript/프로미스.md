# 프로미스

프로미스는 ES6에 추가된 비동기처리 패턴입니다. 콜백 헬 문제 때문에 나오게 되었습니다.

## 비동기 함수

비동기 함수는 함수 내부에 비동기적으로 동작하는 코드를 포함한 함수를 의미합니다. 내부 비동기 코드는 비동기 함수 종료 이후 완료됩니다.

비동기 함수는 반환이나 외부변수에 값 할당을 제대로 하지 못합니다. 이렇기 때문에 비동기 함수의 처리 결과에 대한 후속처리는 비동기 함수 내부에서 수행됩니다. 보통 후속 처리 함수로 콜백으로 넘깁니다. (모든 콜백이 비동기라는 것은 아닙니다.)

## 프로미스의 사용

```js
new Promise((resolve, reject) => {
  // 비동기 코드
  resolve('성공 시 값');
  reject('실패 시 에러 객체');
});
```

Promise의 실행 함수 내부에서 `resolve`, `reject` 중 하나 이상 실행해야 합니다.

## 프로미스의 상태

| 상태 이름 |        상태         |
| :-------: | :-----------------: |
|  pending  | 비동기 처리 수행 전 |
| fulfilled |        성공         |
| rejected  |        실패         |

`fulfilled`, `rejected`상태를 settled 상태라고 합니다. settled상태는 비동기가 수행된 상태를 말합니다.

## 프로미스 후속처리 메서드

프로미스는 후속처리 메서드 `then` `catch` `finally`를 제공합니다.

프로미스의 비동기 처리 상태가 변화하면 후속 상태에 따라 콜백함수가 실행됩니다.

모든 후속처리 메서드는 프로미스를 반환하고 비동기로 동작합니다.

### then

then은 첫번째 매개변수로 프로미스의 값, 두번째 매개변수로 프로미스의 에러를 가집니다.

## 마이크로 태스크 큐

마이크로 태스크 큐는 태스크 큐와 별개입니다. 마이크로 태스크 큐에는 프로미스의 후속 처리 메서드의 콜백이 일시저장됩니다. 그외 비동기의 콜백 이벤트 핸들러가 일시 저장됩니다.

마이크로 태스크 큐는 태스크 큐보다 우선순위가 높습니다. 이벤트 루프는 마이크로 태스크 큐에서 대기하고 있는 함수를 가져와 실행합니다. 마이크로 태스크 큐가 비면 태스크 큐의 함수들을 가져와 실행합니다.

## fetch

fetch 함수는 HTTP응답을 나타내는 Response 객체를 래핑한 프로미스 객체를 리턴합니다.

fetch 함수가 반환하는 프로미스는 HTTP에러가 발생해도 reject하지 않고 Response객체를 리턴합니다. 오프라인이나 CORS에러는 reject합니다.

참고할 만한 링크: [프라미스](https://ko.javascript.info/promise-basics) 
